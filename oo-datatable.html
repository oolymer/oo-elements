<link rel="import" href="../font-roboto/roboto.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-grid/vaadin-grid.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-column.html">
<link rel="import" href="../vaadin-material-theme/vaadin-grid.html">

<dom-module id="oo-datatable">
  <template>
    <style>
      :host {
        display: block;
        @apply --paper-font-common-base;
        @apply --layout-vertical;
      }

      #container {
        @apply --shadow-elevation-2dp;
        @apply --layout-vertical;
        @apply --layout-flex;
      }

      #content {
        @apply --layout-vertical;
        @apply --layout-flex;
      }

      #grid {
        @apply --layout-flex;
      }
    </style>

    <div id="container">
      <slot name="header"></slot>

      <div id="content">
        <vaadin-grid id="grid">
          <vaadin-grid-column width="60px" flex-grow="0">
            <template class="header">#</template>
            <template>[[_calculateItemIndex(index)]]</template>
          </vaadin-grid-column>

          <vaadin-grid-column>
            <template class="header">First Name</template>
            <template>[[item.firstName]]</template>
          </vaadin-grid-column>

          <vaadin-grid-column>
            <template class="header">Last Name</template>
            <template>[[item.lastName]]</template>
          </vaadin-grid-column>

          <vaadin-grid-column width="45%">
            <template class="header">Address</template>
            <template>
              <p style="white-space: normal">[[item.address.street]], [[item.address.city]]</p>
            </template>
          </vaadin-grid-column>
        </vaadin-grid>
      </div>

      <slot name="footer"></slot>
    </div>
  </template>

  <script>
    (function () {
      class OoDatatable extends Polymer.Element {
        static get is() {
          return "oo-datatable"
        }

        static get properties() {
          return {
            items: {
              type: Array,
              value: () => [],
              observer: "_itemsChanged"
            },

            useDataProvider: {
              type: Boolean,
              value: () => false,
              readOnly: false
            }
          }
        }

        ready() {
          super.ready()
          this._log("ready")

          if (this.useDataProvider) {
            this._initDataProvider()
          }
        }

        _itemsChanged(items) {
          if (this.useDataProvider) {
            this._refreshGridData(0, 10)
          }
          else {
            this.$.grid.items = items
          }
        }

        _calculateItemIndex(index) {
          return index + 1
        }

        _initDataProvider() {
          this._log("init data provider")
          const grid = this.$.grid
          grid.set("dataProvider", (params, done) => {
            this._log("handle data provider", params, this.items.length)
            // page, pageSize, sortOrders, filters, parentItem
            // params.page = grid.page
            done(this.items, this.items.length)
          })
        }

        _refreshGridData(page, pageSize) {
          const grid = this.$.grid
          grid.set("page", page)
          grid.set("pageSize", pageSize)
          grid._scrollToIndex(0)
          grid.clearCache()
        }

        _log(...messages) {
          console.log(`[${this.localName}]`, ...messages)
        }
      }

      window.customElements.define(OoDatatable.is, OoDatatable)
    }())
  </script>
</dom-module>

<dom-module id="oo-datatable__vaadin-grid" theme-for="vaadin-grid">
  <template>
    <style>
      :host {
        font-size: 15px;
        border: none;
        min-height: 0;
      }

      [part~="cell"] {
        font-size: 15px;
        padding: 0px 12px;
      }

      [part~="header-cell"] ::slotted(*),
      [part~="footer-cell"] ::slotted(*) {
        font-size: 15px;
        font-weight: normal;
      }
    </style>
  </template>
</dom-module>
